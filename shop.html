<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NeutronTech</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="images/NEUTRONTECH2.svg" type="image/x-icon">
</head>
<body>
<header>
    <a href="index.html" class="logo"><img src="images/logo.svg" alt="NeutronTech Logo" width="100" height="100"></a>
    <h1>NeutronTech </h1>
    <h2>Welcome to NeutronTech, your go-to platform for all things related to technology and computing.</h2>
    <nav>
        <a href="index.html">Home</a>
        <a href="about.html">About</a>
        <a href="services.html">Services</a>
    </nav>
</header>
<main>
    <h2 class="shop">Shop</h2>
    <h2 id="desktop">Desktop</h2>
    <section>
        <div class="card-grid">
        </div>
    </section>
    <h2 id="laptop">Laptop</h2>
    <section>
        <div class="card-grid">
        </div>
    </section>
    <h2 id="gaming">Gaming</h2>
    <section>
        <div class="card-grid">
        </div>
    </section>
    <h2 id="components">Components</h2>
    <section>
        <div class="card-grid">>
        </div>
    </section>
</main>
<footer>
    <!-- Theme Toggle Button -->
    <button id="toggleThemeBtn" type="button" aria-pressed="">Light Mode</button>
    <!-- Cart bottom -->
    <a class="cart" href="cart.html"><img src="images/cart.svg" width="30" height="30"></a>
    <!-- Footer Content -->
    <p> &copy 2025 NeutronTech. All rights reserved. Follow us on:</p>
    <div>
        <a href="https://twitter.com/computech" target="_blank" rel="noopener">Twitter</a>
        <a href="https://facebook.com/computech" target="_blank" rel="noopener">Facebook</a>
        <a href="https://instagram.com/computech" target="_blank" rel="noopener">Instagram</a>
    </div>
</footer>
<!-- Floating Chat Icon -->
<div class="chat-float-icon">
    <img src="images/logo.svg" alt="Chat with NeutronTech" width="60" height="60" />
</div>

<!-- Chat Window (hidden by default) -->
<div class="chat-window">
    <div class="chat-header">Chat NeutronTech <span class="chat-close">&times;</span></div>
    <div class="chatbox"></div>
    <label>
        <input class="userInput" placeholder="Type your message..." />
    </label>
    <button class="chat-send">Send</button>
</div>
</body>
</html>
<script>
    // Load products by category and render them
    async function loadProducts(category) {
        const res = await fetch(`http://localhost:3000/api/products/category/${category}`);
        const products = await res.json();
        const grid = document.querySelector(`#${category} + section .card-grid`);
        grid.innerHTML = '';
        products.forEach(product => {
            grid.innerHTML += `
        <div class="featured-card">
            <img src="${product.imageUrl || 'images/desktop.jpg'}" alt="${category}" width="400" height="300">
            <h3>${product.name}</h3>
            <p>${product.description}</p>
            <p>${product.price} USD</p>
            ${
                product.stock > 0
                    ? `<button class="button" onclick="addToCart('${product.name}', '${product.description}', '${product.price}', '${product.imageUrl}', '${product.id}')">Purchase</button>`
                    : `<button class="button" disabled>Sold out</button>`
            }
        </div>
        `;
        });
    }

    // Load all categories on page load
    window.addEventListener('DOMContentLoaded', () => {
        ['desktop', 'laptop', 'gaming', 'components'].forEach(loadProducts);
    });

    let cart = [];

    function loadCartFromLocalStorage() {
        const savedCart = localStorage.getItem('cart');
        if (savedCart) cart = JSON.parse(savedCart);
    }

    // Llamar al cargar la pÃ¡gina
    window.addEventListener('DOMContentLoaded', loadCartFromLocalStorage);
    async function addToCart(name, description, price, image, id) {
        const saved = localStorage.getItem('cart');
        cart = saved ? JSON.parse(saved) : [];
        const product = { nombre: name, description: description, precio: price, imagen: image, id: id };
        cart.push(product);
        localStorage.setItem('cart', JSON.stringify(cart));
        await fetch('http://localhost:3000/api/products/decrement-stock', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ id })
        });
        alert(`${name} ha sido agregado al carrito`);
    }

    (function () {
        const KEY = 'themeInverted';
        const saved = localStorage.getItem(KEY) === 'true';
        const html = document.documentElement;
        if (saved) html.classList.add('theme-inverted');

        const btn = document.getElementById('toggleThemeBtn');
        const updateLabel = () => {
            const inverted = html.classList.contains('theme-inverted');
            btn.textContent = inverted ? 'Dark Mode' : 'Light Mode';
            btn.setAttribute('aria-pressed', String(inverted));
        };

        if (btn) {
            updateLabel();
            btn.addEventListener('click', () => {
                html.classList.toggle('theme-inverted');
                localStorage.setItem(KEY, String(html.classList.contains('theme-inverted')));
                updateLabel();
            });
        }
    })();

    // Toggle the chat window (show/hide)
    document.querySelector('.chat-float-icon').onclick = function() {
        const chatWindow = document.querySelector('.chat-window');
        if (chatWindow.style.display === 'flex') {
            chatWindow.style.display = 'none';
        } else {
            chatWindow.style.display = 'flex';
        }
    };
    // Close the chat window
    document.querySelector('.chat-close').onclick = function() {
        document.querySelector('.chat-window').style.display = 'none';
    };

    // Send a message on a button click
    document.querySelector('.chat-send').onclick = sendMessage;
    // Send a message on an Enter key
    document.querySelector('.userInput').addEventListener('keydown', function(e) {
        if (e.key === 'Enter') sendMessage();
    });

    async function sendMessage() {
        const inputElem = document.querySelector('.userInput');
        const chatbox = document.querySelector('.chatbox');
        const input = inputElem.value.trim();
        if (!input) return;
        chatbox.innerHTML += `<p><b>You:</b> ${input}</p>`;
        inputElem.value = '';
        // Add typing indicator
        const typingId = 'bot-typing';
        chatbox.innerHTML += `<p id="${typingId}"><i>Bot is typing...</i></p>`;
        chatbox.scrollTop = chatbox.scrollHeight;
        try {
            const res = await fetch('http://localhost:3000/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: input }),
            });
            const data = await res.json();
            // Remove the typing indicator
            const typingElem = document.getElementById(typingId);
            if (typingElem) typingElem.remove();
            chatbox.innerHTML += `<p><b>Bot:</b> ${data.reply}</p>`;
            chatbox.scrollTop = chatbox.scrollHeight;
        } catch (error) {
            console.error('Error:', error);
            const typingElem = document.getElementById(typingId);
            if (typingElem) typingElem.remove();
            chatbox.innerHTML += `<p><b>Bot:</b> Error del cliente. Intenta nuevamente.</p>`;
            chatbox.scrollTop = chatbox.scrollHeight;
        }
    }
</script>